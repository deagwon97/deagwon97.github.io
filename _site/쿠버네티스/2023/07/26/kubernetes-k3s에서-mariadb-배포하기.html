<!DOCTYPE html>
<html lang="en"><head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="bdg-blog" /></head>
<style>@import url(/public/css/syntax/monokai.css);</style>
  <title>bdg-blog</title>
  <!-- <link href="/public/css/bootstrap.min.css" rel="stylesheet"> -->

  <link href="/public/css/style.css" rel="stylesheet">
  <body>
  	<div class="container"> 
		<div class="sidebar">
			<div class="sidebar-item sidebar-header">
	<div class='sidebar-brand'>
		<a href="/">bdg-blog</a>
	</div>
	<p class="lead"></p></div>

<div class="sidebar-item sidebar-nav">
	<ul class="nav">
      <li class="nav-title">Pages</li>
	  <li>
	  	<a class="nav-item" href="/">Articles</a>
	  </li>
	  
	  
	    
	  
	    
	      
	    
	  
	    
	  
	    
	  
	</ul>
</div>

<div class="sidebar-item sidebar-nav">
  	<ul class="nav">
			<li class="nav-title">Categories</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#쿠버네티스">
				<span class="name">쿠버네티스</span>
				<span class="badge">10</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#기타">
				<span class="name">기타</span>
				<span class="badge">8</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#운영체제/컴퓨터구조">
				<span class="name">운영체제/컴퓨터구조</span>
				<span class="badge">7</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#백앤드">
				<span class="name">백앤드</span>
				<span class="badge">5</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#컨테이너">
				<span class="name">컨테이너</span>
				<span class="badge">2</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#Go">
				<span class="name">Go</span>
				<span class="badge">6</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#클린 아키텍쳐">
				<span class="name">클린 아키텍쳐</span>
				<span class="badge">2</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#보안">
				<span class="name">보안</span>
				<span class="badge">2</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#리눅스">
				<span class="name">리눅스</span>
				<span class="badge">1</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#네트워크">
				<span class="name">네트워크</span>
				<span class="badge">4</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#자바스크립트">
				<span class="name">자바스크립트</span>
				<span class="badge">1</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#클린 코드">
				<span class="name">클린 코드</span>
				<span class="badge">1</span>
	    	</a>
 		</li>
	    
	  </nav>
	</ul>
</div>

<div class="sidebar-item sidebar-footer">
</div>
		</div>
		<div class="content">
			<article class="post">
	<header class="post-header">
		<div class="post-title"> 
			[kubernetes] k3s에서 mariadb 배포하기
		</div>
		<time class="post-date dt-published" datetime="2023-07-26T20:10:09+09:00" itemprop="datePublished">2023/07/26
		</time>		
	</header>

	<div class="post-content">
		<p><img alt="image" src="/images/bceea9b1-6e40-476c-ba01-88cdd2d69dda" /></p>

<p>필자는 그동안 AWS의 RDS를 주로 사용해왔다. 지금까지 진행한 개인 프로젝트들은 DB에 접근하는 작업이 많지 않았기 때문에, 부담되지 않는 가격으로 간편하게 클라우드 서비스를 이용했다.</p>

<p>하지만, 최근 테스트 코드를 자주 활용하면서, db에 접근하는 횟수가 크게 늘었고, RDS에 지불하는 가격이 신경 쓰이기 시작했다. 이러한 이유로 클라우드에서 독립하여 개인 데이터 베이스를 구축했다.</p>

<p>이번 포스트에서는 쿠버네티스(k3s), traefik, mariadb를 조합하여 데이터베이스 서비스를 구축하는 방법에 대해 다루고, 이론적인 내용은 다음 포스트에서 자세히 다루겠다.</p>

<h2 id="1-secret-생성하기">1. secret 생성하기</h2>

<p>데이터 베이스의 패스워드와 같은 민감한 설정값들을 secret으로 생성하여 관리한다. 이렇게 만들어진 secret은 deployment를 정의할 때, 포함된다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// env.db

MYSQL_HOST=%
MYSQL_PORT=3306
MYSQL_ROOT_PASSWORD=passwordimnida
MYSQL_DATABASE=nameimnida
MYSQL_USER=usernameimnida
MYSQL_PASSWORD=newpasswordimnida
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nv">$ </span>kubectl create secret generic mariadb-bdg <span class="nt">--from-env-file</span> env.db

<span class="nv">$ </span><span class="nb">rm</span> ./env.db
</code></pre></div></div>

<h2 id="2-persistentvolume-정의하기">2. PersistentVolume 정의하기</h2>

<p>퍼시스턴트볼륨은 클러스터에서 생성된 스토리지 자원이다. 노드가 클러스터의 리소스인 것처럼 PV는 클러스터의 리소스에 속한다. 퍼시스턴트의 볼륨에 저장된 데이터는 스토리지에 저장되기 때문에, 클러스터가 종료되어도, 데이터가 유지된다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolume</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb-pv</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">local</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">manual</span>
  <span class="na">capacity</span><span class="pi">:</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="s">5Gi</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">hostPath</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/mnt/data"</span>
</code></pre></div></div>

<h2 id="3-persistentvolumeclaim-정의하기">3. PersistentVolumeClaim 정의하기</h2>

<p><em>퍼시스턴트볼륨클레임</em> (PVC)은 사용자의 스토리지에 대한 요청을 처리하는 자원이다. PVC는 PV 리소스를 사용하며, 우리가 만들 데이터베이스의 디플로이먼트와 연결된다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb-pv-claim</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">manual</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">5Gi</span>
</code></pre></div></div>

<h2 id="4-deployment-정의">4. Deployment 정의</h2>

<p>mariadb image를 통해서 데이터 베이스를 생성하고자 한다. 미리 생성한 secret, persistace volume claim을 연결하여 하나의 데이터 베이스 디플로이멘트를 정의한다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">mariadb</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">Recreate</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">mariadb</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">mariadb:latest</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb</span>
          <span class="na">envFrom</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">secretRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb-bdg</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">3306</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb-persistent-storage</span>
              <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/lib/mysql</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb-persistent-storage</span>
          <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
            <span class="na">claimName</span><span class="pi">:</span> <span class="s">mariadb-pv-claim</span>
</code></pre></div></div>

<h2 id="5-service-정의하기">5. Service 정의하기</h2>

<p>deployment가 배포되었다고 해도, 아직 pod 외부에서 접근할 수 없다. pod외부에서 pod에 접근할 수 있도록 서비스를 정의한다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">3306</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">3306</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">mariadb</span>
</code></pre></div></div>

<p>정상적으로 서비스가 배포되면 해당 팟으로 접근하는 cluster-ip가 생성된다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get services

<span class="o">&gt;&gt;</span>
NAME     TYPE          CLUSTER-IP     EXTERNAL-IP              PORT<span class="o">(</span>S<span class="o">)</span>       
mariadb  LoadBalancer  10.43.232.156  172.30.1.13,172.30.1.21  3306:31955/TCP
</code></pre></div></div>

<p>cluster-ip를 통해서 mariadb에 접근하여  데이터베이스가 잘 동작하는지 확인한다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mysql <span class="nt">-h</span> localhost <span class="nt">-P</span> 10.43.232.156 <span class="nt">-u</span> root <span class="nt">-p</span>
Enter password: <span class="k">************</span>

<span class="o">&gt;&gt;</span> 
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 14
Server version: 10.8.3-MariaDB-1:10.8.3+maria~jammy mariadb.org binary distribution

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| your_database_name |
| sys                |
+--------------------+
6 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.004 sec<span class="o">)</span>
</code></pre></div></div>

<h2 id="6-클러스터-외부로-배포하기">6. 클러스터 외부로 배포하기</h2>

<p>지금까지 데이터베이스를 생성하고, 클러스터 내부에서 db에 접근하는 방법에 대해 알아보았다. 클러스터 외부에서 db에 직접 접근하는 방식은 보안상 취약점이 많기 때문에 여기까지 배포해두고, 클러스터의 노드에 따로 접근하여 개발하고 배포하는 것을 권장한다.</p>

<p>하지만, 클러스터 외부에서 데이터 베이스에 직접 접근하고자 할 수도 있다. 이를 위해서는 새로운 <code class="highlighter-rouge">ingress router</code>를 생성해야 한다. 필자의 클러스터는 k3s에 내장된 <code class="highlighter-rouge">traefik</code>이라는 <code class="highlighter-rouge">ingress controller</code>를 사용하여 클러스터 외부의 요청을 처리한다.</p>

<p><code class="highlighter-rouge">traefik</code> 를 사용하여 일반적인 web서비스를 클러스터 외부로 배포하는 <code class="highlighter-rouge">ingressRouter</code> 설정은 매우 간단하다. 하지만 database와 같은 http, https 와 다른 프로토콜을 사용하는 서비스를 배포하기 위해서는 몇 가지 작업을 추가해야 한다.</p>

<h3 id="6-1-traefik-entrypoints-추가하기">6-1. Traefik entrypoints 추가하기</h3>

<p><code class="highlighter-rouge">traefik</code> 은 기본 entry point로 80(<code class="highlighter-rouge">web</code>), 443(<code class="highlighter-rouge">websecure</code>), 1704/udp(<code class="highlighter-rouge">streaming</code>)포트를 지원한다.  따라서 <code class="highlighter-rouge">web</code> 혹은 <code class="highlighter-rouge">websecure</code> entry points를 배포하는  <code class="highlighter-rouge">ingressRoutes</code> 설정은 다음과 같이 작성하면 된다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">traefik.containo.us/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">IngressRoute</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ingressroute-my-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">entryPoints</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">websecure</span>
  <span class="na">routes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">match</span><span class="pi">:</span> <span class="s">Host(``deagwon.com``)</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">Rule</span>
    <span class="na">services</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">bdg-front</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
<span class="err">	</span><span class="na">tls</span><span class="pi">:</span> <span class="pi">{}</span>
</code></pre></div></div>

<p>하지만, 앞서 언급했듯이 <code class="highlighter-rouge">traefik</code>은 database에서 주로 사용하는 3306포트를 지원하지 않는다. 따라서 <code class="highlighter-rouge">traefik</code>의 설정값 변경하여 3306 포트를 추가한다.</p>

<p>일반적인 방법으로 k3s를 설치했다면 다음 경로에 k3s의 manifests 폴더가 위치한다. 해당 경로에 traefik-config.yaml을 생성한다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo ls</span> /var/lib/rancher/k3s/server/manifests/

<span class="o">&gt;&gt;</span> 
ccm.yaml      local-storage.yaml  rolebindings.yaml    traefik.yaml
coredns.yaml  metrics-server
</code></pre></div></div>

<p><code class="highlighter-rouge">/var/lib</code> 경로의 파일들은 관리자만 접근할 수 있기 때문에 관리자 계정으로 접근하거나, <code class="highlighter-rouge">sudo</code> 를 넣어주면 접근할 수 있다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>vi /var/lib/rancher/k3s/server/manifests/traefik-config.yaml
</code></pre></div></div>

<p><code class="highlighter-rouge">mariadb</code>의 배포를 위해서 생성하는 entry point이므로 이름을 <code class="highlighter-rouge">mariadb</code>로 하였다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># /var/lib/rancher/k3s/server/manifests/traefik-config.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">helm.cattle.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">HelmChartConfig</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">traefik</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">valuesContent</span><span class="pi">:</span> <span class="pi">|-</span>
    <span class="s">additionalArguments:</span>
    <span class="s">- "--entryPoints.mariadb.address=:3306"</span>
  <span class="na">entryPoints</span><span class="pi">:</span>
     <span class="na">mariadb</span><span class="pi">:</span>
      <span class="na">address</span><span class="pi">:</span> <span class="s1">'</span><span class="s">:3306'</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>kubectl apply <span class="nt">-f</span> /var/lib/rancher/k3s/server/manifests/traefik-config.yaml
</code></pre></div></div>

<p>이렇게 하면, <code class="highlighter-rouge">traefik</code>의 <code class="highlighter-rouge">ingressRouter</code>에서 <code class="highlighter-rouge">mariadb</code>라는 이름의 entry point를 사용할 수 있게 된다.</p>

<h3 id="6-2-ingressroutetcp-생성하기">6-2. IngressRouteTCP 생성하기</h3>

<p>클러스터 외부에서 <code class="highlighter-rouge">mariadb</code> entry point로 들어오는 요청을 <code class="highlighter-rouge">mariadb</code> 서비스로 라우팅하는 ingress router를 정의한다.</p>

<p><code class="highlighter-rouge">IngressRoute</code> 가 http 요청을 routing한다면, <code class="highlighter-rouge">IngressRouteTCP</code>는 tcp 요청을 routing하는 쿠버네티스 커스텀 자원(CRD)이다. <code class="highlighter-rouge">ingressRoute</code> 에서 Host를 매치 조건으로 사용하는 반면, <code class="highlighter-rouge">IngressRouteTCP</code>  는 HostSNI(Server Name Indication)를 매치 조건으로 사용한다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">traefik.containo.us/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">IngressRouteTCP</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb-ingressroute</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">entryPoints</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">mariadb</span>
  <span class="na">routes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">match</span><span class="pi">:</span> <span class="s">HostSNI(``*``)</span>
    <span class="na">services</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mariadb</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">3306</span>
</code></pre></div></div>

<p>이제 클러스터 외부에서도 데이터베이스에 접근할 수 있다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mysql <span class="nt">-h</span> localhost <span class="nt">-P</span> my-pulic-ip <span class="nt">-u</span> root <span class="nt">-p</span>
Enter password: <span class="k">************</span>

<span class="o">&gt;&gt;</span> 
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 14
Server version: 10.8.3-MariaDB-1:10.8.3+maria~jammy mariadb.org binary distribution

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| your_database_name |
| sys                |
+--------------------+
6 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.004 sec<span class="o">)</span>
</code></pre></div></div>

<h3 id="6-3-주의사항">6-3. 주의사항</h3>

<ul>
  <li>3306포트가 외부에서 클러스터까지 적절히 포트포워딩돼야 한다.</li>
  <li>방화벽에 3306포트가 열려있어야 한다.</li>
  <li>외부 엔드 포인트를 3306 이외의 다른 포트를 두고(ex. mariadb, :12314), 내부 서비스에 포워딩하는 것이 보안상 유리하다.</li>
</ul>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="https://stackoverflow.com/questions/63633098/traefik-2-2-1-expose-mysql-service-in-kubernetes-cluster">https://stackoverflow.com/questions/63633098/traefik-2-2-1-expose-mysql-service-in-kubernetes-cluster</a></li>
  <li><a href="https://docs.rke2.io/helm/#customizing-packaged-components-with-helmchartconfig">https://docs.rke2.io/helm/#customizing-packaged-components-with-helmchartconfig</a></li>
  <li><a href="https://rancher.com/docs/k3s/latest/en/helm/">https://rancher.com/docs/k3s/latest/en/helm/</a></li>
  <li><a href="https://doc.traefik.io/traefik/routing/entrypoints/">https://doc.traefik.io/traefik/routing/entrypoints/</a></li>
</ul>

	</div>
	<br/>
	<br/>
	<script src="https://utteranc.es/client.js"
        repo="deagwon97/deagwon97.github.io"
        issue-term="url"
        theme="github-light"
        crossorigin="anonymous"
        async>
	</script>
</article>
		</div>
	</div>
  </body>
</html>