<!DOCTYPE html>
<html lang="en"><head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="bdg-blog" /></head>
<style>@import url(/public/css/syntax/monokai.css);</style>
  <title>bdg-blog</title>
  <!-- <link href="/public/css/bootstrap.min.css" rel="stylesheet"> -->

  <link href="/public/css/style.css" rel="stylesheet">
  <body>
  	<div class="container"> 
		<div class="sidebar">
			<div class="sidebar-item sidebar-header">
	<div class='sidebar-brand'>
		<a href="/">bdg-blog</a>
	</div>
	<p class="lead"></p></div>

<div class="sidebar-item sidebar-nav">
	<ul class="nav">
      <li class="nav-title">Pages</li>
	  <li>
	  	<a class="nav-item" href="/">Articles</a>
	  </li>
	  
	  
	    
	  
	    
	      
	    
	  
	    
	  
	    
	  
	</ul>
</div>

<div class="sidebar-item sidebar-nav">
  	<ul class="nav">
			<li class="nav-title">Categories</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#쿠버네티스">
				<span class="name">쿠버네티스</span>
				<span class="badge">10</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#기타">
				<span class="name">기타</span>
				<span class="badge">8</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#운영체제/컴퓨터구조">
				<span class="name">운영체제/컴퓨터구조</span>
				<span class="badge">7</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#백앤드">
				<span class="name">백앤드</span>
				<span class="badge">5</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#컨테이너">
				<span class="name">컨테이너</span>
				<span class="badge">2</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#Go">
				<span class="name">Go</span>
				<span class="badge">6</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#클린 아키텍쳐">
				<span class="name">클린 아키텍쳐</span>
				<span class="badge">2</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#보안">
				<span class="name">보안</span>
				<span class="badge">2</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#리눅스">
				<span class="name">리눅스</span>
				<span class="badge">1</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#네트워크">
				<span class="name">네트워크</span>
				<span class="badge">4</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#자바스크립트">
				<span class="name">자바스크립트</span>
				<span class="badge">1</span>
	    	</a>
 		</li>
	    
	    <li>
	    	<a class="nav-item" href="/category/#클린 코드">
				<span class="name">클린 코드</span>
				<span class="badge">1</span>
	    	</a>
 		</li>
	    
	  </nav>
	</ul>
</div>

<div class="sidebar-item sidebar-footer">
</div>
		</div>
		<div class="content">
			<article class="post">
	<header class="post-header">
		<div class="post-title"> 
			Start: Downloading VS Code Server Too Slow!
		</div>
		<time class="post-date dt-published" datetime="2023-07-26T20:20:35+09:00" itemprop="datePublished">2023/07/26
		</time>		
	</header>

	<div class="post-content">
		<p>필자는 대부분의 개발을 remote server → remote container 에서 수행한다.  VS code의 remote-ssh 익스텐션과 remote-container 익스텐션을 활용하면, 이런 작업을 대부분 자동화 할 수 있다.</p>

<p>예를 들어 미리 실행되고 있는 container내부에 VSCode로 접속하기 위해서는 이 Container에  VS code Server를 설치해야한다. 이런 일련의 설치과정은 remote-container라는 익스텐션이 자동으로 수행한다.</p>

<h3 id="문제-상황">문제 상황</h3>
<p>하지만, 가끔 아래와 같이 6d9b74a70ca9c7733b29f0456fd8195364076dda 라는 파일을 다운받을 때, 시간이 매우 오래 걸리기도 한다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">.</span>
<span class="nb">.</span>
<span class="nb">.</span>
<span class="nb">.</span>
<span class="o">[</span>5639 ms] 
<span class="o">[</span>5639 ms] 
<span class="o">[</span>5640 ms] Start: Run <span class="k">in </span>container: <span class="nb">test</span> <span class="nt">-d</span> /root/.vscode-server/bin/6d9b74a70ca9c7733b29f0456fd8195364076dda
<span class="o">[</span>5655 ms] 
<span class="o">[</span>5655 ms] 
<span class="o">[</span>5655 ms] Exit code 1
<span class="o">[</span>5655 ms] Start: Run <span class="k">in </span>container: <span class="nb">test</span> <span class="nt">-d</span> /vscode/vscode-server/bin/linux-x64/6d9b74a70ca9c7733b29f0456fd8195364076dda
<span class="o">[</span>5670 ms] 
<span class="o">[</span>5670 ms] 
<span class="o">[</span>5670 ms] Exit code 1
<span class="o">[</span>5670 ms] Installing VS Code Server <span class="k">for </span>commit 6d9b74a70ca9c7733b29f0456fd8195364076dda
<span class="o">[</span>5671 ms] Start: Downloading VS Code Server
<span class="o">[</span>5671 ms] 6d9b74a70ca9c7733b29f0456fd8195364076dda linux-x64 stable
</code></pre></div></div>

<p>하루 자고 일어나서 다시 시도해보면, 잘 동작하기 때문에 MS의 사소한 버그라고 생각하고 그날은 개발을 쉬었다.</p>

<p>하지만, 급하게 개발을 해야할 때는 꽤나 곤란한 상황이 발생하기 때문에 미리 해결책을 찾아보았다.</p>

<p>필자가 이 문제를 직면한 날로부터 28일 전에 똑같은 문제를 겪은 분이 있었다.</p>

<p><img alt="image" src="/images/992707c2-23ce-4df8-ad30-3bb5229c4e58" /></p>

<p><a href="https://github.com/microsoft/vscode-remote-release/issues/6948">https://github.com/microsoft/vscode-remote-release/issues/6948</a></p>

<p>한국에서 이런 일이 종종 발생하는 것으로 보인다. 이슈로 등록되어 있지만, 마땅한 해결책은 찾을 수가 없었다.</p>

<h3 id="해결책임시">해결책(임시)</h3>
<p>미봉책으로 remote 서버의 vscode-server 파일을 container에 복사하여 접속한다.</p>

<p>참고로 필자는 dockerfile, build context, docker-compose.yml 파일 경로는 다음처럼 설정한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/user/srv
└── project
    ├── .devcontainer
    │   ├── devcontainer.json
    │   └── docker-compose.yml
		├── .gitignore
		├── .git
    │   └── ...
    │  
    ├── .env
    ├── Dockerfile
    ├── README.md
    └── src
        └── project source files ..
</code></pre></div></div>

<p>이제 remote 서버의 vscode-server 파일을 복사하여 project 폴더 아래에 둔다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo cp</span> <span class="nt">-r</span> /home/user/.vscode-server/bin /home/user/srv/project/.vscode-server/bin
</code></pre></div></div>

<p>다음처럼 .vscode-server 폴더가 생겼다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/user/srv
└── project
    ├── .devcontainer
    │   ├── devcontainer.json
    │   └── docker-compose.yml
		├── .gitignore
		├── .git
    │   └── ...
    │  
    ├── .vscode-server
    │   └── bin
    │       ├── 3b889b090b5ad5793f524b5d1d39fda662b96a2a
    │       │   ├── LICENSE
    │       │   ├── bin
    │       │   │   ├── code-server
    │  
    ├── .env
    ├── Dockerfile
    ├── README.md
    └── src
        └── project source files ..
</code></pre></div></div>

<p>이제 기존의 Dockerfile를 수정하여 <code class="highlighter-rouge">/root/.vscode-server/bin</code> 경로에 <code class="highlighter-rouge">./.vscode-server/bin</code> 를 복사한다. (만약 root user가 아니라 다른 user를 사용한다면 경로를 바꿔야한다.)</p>

<div class="language-docker highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">FROM</span><span class="s"> base-image</span>

.
.
.

 
<span class="k">COPY</span><span class="s"> ./.vscode-server/bin /root/.vscode-server/bin</span>

.
.
</code></pre></div></div>

<p>이후 다시 이미지를 빌드하고  Remote-Containers: Open Folder in Container.. 로 devcontainer에 접속하면</p>

<p><img alt="image" src="/images/8fa9cdca-c6aa-4561-ae68-b7e3ac947cf0" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>181319 ms] 
<span class="o">[</span>181319 ms] 
<span class="o">[</span>181409 ms] Start: Run <span class="k">in </span>Host: docker inspect <span class="nt">--type</span> container 0ed74ff3f7cfb1a59a27f7b6e9acdf9d6f17df136306d490db35c63701ed2048
<span class="o">[</span>181502 ms] Start: Run <span class="k">in </span>Host: /home/-/.vscode-server/bin/6d9b74a70ca9c7733b29f0456fd8195364076dda/node /home/-/.vscode-remote-containers/dist/dev-containers-cli-0.241.3/dist/spec-node/devContainersSpecCLI.js read-configuration <span class="nt">--workspace-folder</span> /home/ubuntu/srv/- <span class="nt">--log-level</span> debug <span class="nt">--log-format</span> json <span class="nt">--config</span> /home/ubuntu/srv/-/.devcontainer/devcontainer.json <span class="nt">--mount-workspace-git-root</span> <span class="nb">true</span>
<span class="o">[</span>181775 ms] Start: Run <span class="k">in </span>Host: docker-compose version <span class="nt">--short</span>
<span class="o">[</span>181844 ms] Start: Inspecting container
<span class="o">[</span>181844 ms] Start: Run <span class="k">in </span>Host: docker inspect <span class="nt">--type</span> container 0ed74ff3f7cfb1a59a27f7b6e9acdf9d6f17df136306d490db35c63701ed2048
<span class="nb">.</span>
<span class="nb">.</span>
.[187728 ms] <span class="o">[</span>13:25:17] Renamed to /root/.vscode-server/extensions/esbenp.prettier-vscode-9.5.0
<span class="o">[</span>187736 ms] <span class="o">[</span>13:25:17] Extracting completed. esbenp.prettier-vscode
<span class="o">[</span>187740 ms] <span class="o">[</span>13:25:17] Extension installed successfully: esbenp.prettier-vscode
<span class="o">[</span>187744 ms] Extension <span class="s1">'esbenp.prettier-vscode'</span> v9.5.0 was successfully installed.
<span class="o">[</span>391533 ms] Start: Run <span class="k">in </span>container: <span class="nb">cat</span> /proc/951/environ
</code></pre></div></div>

<p>성공적으로 접속할 수 있다! 급할 때는 이렇게 vscode-server파일을 복사하여 사용할 수 있다. 하지만, 근본적인 해결책은 아니다.</p>

<h3 id="reference">reference</h3>
<ul>
  <li>https://github.com/microsoft/vscode-remote-release/issues/6948</li>
</ul>

	</div>
	<br/>
	<br/>
	<script src="https://utteranc.es/client.js"
        repo="deagwon97/deagwon97.github.io"
        issue-term="url"
        theme="github-light"
        crossorigin="anonymous"
        async>
	</script>
</article>
		</div>
	</div>
  </body>
</html>